# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç SQLite –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä–∞—è —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ Docker volume –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ. –ï—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–ø–æ—Å–æ–±–æ–≤ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ.

## üìã –í–∞—Ä–∏–∞–Ω—Ç—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

### 1. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö —Å —Å–µ—Ä–≤–µ—Ä–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–°–∫—Ä–∏–ø—Ç `connect-db-server.sh` –∫–æ–ø–∏—Ä—É–µ—Ç –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö —Å —Å–µ—Ä–≤–µ—Ä–∞ –ª–æ–∫–∞–ª—å–Ω–æ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏ –∞–Ω–∞–ª–∏–∑–∞.

```bash
# –î–ª—è DEV –æ–∫—Ä—É–∂–µ–Ω–∏—è
./connect-db-server.sh dev user@server.example.com

# –î–ª—è PROD –æ–∫—Ä—É–∂–µ–Ω–∏—è
./connect-db-server.sh prod user@server.example.com
```

–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –±—É–¥–µ—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ `backend/prisma/{env}_server.db`.

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä —á–µ—Ä–µ–∑ sqlite3
sqlite3 backend/prisma/dev_server.db

# –ò–ª–∏ —á–µ—Ä–µ–∑ Prisma Studio
cd backend
DATABASE_URL="file:./prisma/dev_server.db" npx prisma studio
```

---

### 2. –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è —á–µ—Ä–µ–∑ SSH –∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É

–°–∫—Ä–∏–ø—Ç `connect-db-ssh.sh` –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—É—é —Å–µ—Å—Å–∏—é –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ.

```bash
# –î–ª—è DEV –æ–∫—Ä—É–∂–µ–Ω–∏—è
./connect-db-ssh.sh dev user@server.example.com

# –î–ª—è PROD –æ–∫—Ä—É–∂–µ–Ω–∏—è
./connect-db-ssh.sh prod user@server.example.com
```

–ü–æ—Å–ª–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –≤—ã –º–æ–∂–µ—Ç–µ:
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `sqlite3` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π
- –ó–∞–ø—É—Å—Ç–∏—Ç—å `npx prisma studio` –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
- –í—ã–ø–æ–ª–Ω–∏—Ç—å –ª—é–±—ã–µ –∫–æ–º–∞–Ω–¥—ã –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

---

### 3. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö —Å —Å–µ—Ä–≤–µ—Ä–∞

–°–∫—Ä–∏–ø—Ç `sync-db-from-server.sh` –∑–∞–º–µ–Ω—è–µ—Ç –ª–æ–∫–∞–ª—å–Ω—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –≤–µ—Ä—Å–∏—é —Å —Å–µ—Ä–≤–µ—Ä–∞ (—Å —Å–æ–∑–¥–∞–Ω–∏–µ–º —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏).

```bash
# –î–ª—è DEV –æ–∫—Ä—É–∂–µ–Ω–∏—è
./sync-db-from-server.sh dev user@server.example.com

# –î–ª—è PROD –æ–∫—Ä—É–∂–µ–Ω–∏—è
./sync-db-from-server.sh prod user@server.example.com
```

‚ö†Ô∏è **–í–Ω–∏–º–∞–Ω–∏–µ:** –≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –ø–µ—Ä–µ–∑–∞–ø–∏—à–µ—Ç –≤–∞—à—É –ª–æ–∫–∞–ª—å–Ω—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö! –°–æ–∑–¥–∞–µ—Ç—Å—è —Ä–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è –≤ `backend/prisma/{env}.db.backup`.

---

## üîß –†—É—á–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

–ï—Å–ª–∏ —Å–∫—Ä–∏–ø—Ç—ã –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç, –º–æ–∂–Ω–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –≤—Ä—É—á–Ω—É—é:

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ Docker

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
ssh user@server.example.com

# –ù–∞–π—Ç–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker ps | grep slavalarionov-backend

# –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –±–∞–∑—É –∏–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker cp slavalarionov-backend-dev:/app/backend/prisma/dev.db /tmp/dev.db

# –°–∫–∞—á–∞—Ç—å –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—É—é –º–∞—à–∏–Ω—É (–≤ –¥—Ä—É–≥–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ)
scp user@server.example.com:/tmp/dev.db ./backend/prisma/dev_server.db
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –†–∞–±–æ—Ç–∞ —á–µ—Ä–µ–∑ Docker volume

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
ssh user@server.example.com

# –ù–∞–π—Ç–∏ volume
docker volume ls | grep backend_db

# –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ volume
docker run --rm -it -v slavalarionov-base_backend_db_dev:/data alpine sh

# –í–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
cd /data
ls -la
sqlite3 dev.db
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: Prisma Studio —á–µ—Ä–µ–∑ SSH —Ç—É–Ω–Ω–µ–ª—å

```bash
# –°–æ–∑–¥–∞—Ç—å SSH —Ç—É–Ω–Ω–µ–ª—å
ssh -L 5555:localhost:5555 user@server.example.com

# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
docker exec -it slavalarionov-backend-dev sh
cd /app/backend
DATABASE_URL="file:./prisma/dev.db" npx prisma studio --port 5555

# –ù–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ –æ—Ç–∫—Ä–æ–π—Ç–µ http://localhost:5555
```

---

## üì• –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ JSON-–±—ç–∫–∞–ø–∞ (—Ñ–∞–π–ª `bd`)

–ï—Å–ª–∏ –≤—ã —Å–∫–∞—á–∞–ª–∏ –±—ç–∫–∞–ø –≤ –≤–∏–¥–µ JSON –≤ —Ñ–∞–π–ª `bd` (—ç–∫—Å–ø–æ—Ä—Ç –º–æ–¥–µ–ª–µ–π —á–∞—Å–æ–≤ —Å API), –µ–≥–æ –º–æ–∂–Ω–æ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –∫ –ª–æ–∫–∞–ª—å–Ω–æ–π –±–∞–∑–µ —Ç–∞–∫:

```bash
cd backend

# –í–∞–∂–Ω–æ: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ file:./dev.db (–±–µ–∑ prisma/), —á—Ç–æ–±—ã –ø–∏—Å–∞—Ç—å –≤ —Ç—É –∂–µ –±–∞–∑—É, —á—Ç–æ –∏ –±—ç–∫–µ–Ω–¥.
# –ò–Ω–∞—á–µ Prisma —Å–æ–∑–¥–∞—Å—Ç backend/prisma/prisma/dev.db, –∏ –∞–¥–º–∏–Ω–∫–∞ –±—É–¥–µ—Ç –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ.

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –±—ç–∫–∞–ø –∏–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞ (—Ñ–∞–π–ª bd –∏–ª–∏ bd.json)
DATABASE_URL="file:./dev.db" yarn prisma:import-backup

# –ò–ª–∏ —É–∫–∞–∑–∞—Ç—å –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É –±—ç–∫–∞–ø–∞
DATABASE_URL="file:./dev.db" yarn prisma:import-backup /–ø—É—Ç—å/–∫/–≤–∞—à–µ–º—É/–±—ç–∫–∞–ø—É.json
```

–°–∫—Ä–∏–ø—Ç:
- —Å–∫–∞—á–∏–≤–∞–µ—Ç –≤—Å–µ –∫–∞—Ä—Ç–∏–Ω–∫–∏ –ø–æ URL –≤ `backend/uploads/` –∏ –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –ª–æ–∫–∞–ª—å–Ω—ã–µ –ø—É—Ç–∏;
- –¥–æ–±–∞–≤–ª—è–µ—Ç/–æ–±–Ω–æ–≤–ª—è–µ—Ç —Ü–≤–µ—Ç–∞ –∏ —Ä–µ–º–µ—à–∫–∏;
- **–ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–º–µ–Ω—è–µ—Ç** –º–æ–¥–µ–ª–∏ —á–∞—Å–æ–≤, —Ä–∞–∑–º–µ—Ä—ã, —Ü–≤–µ—Ç –∫–æ—Ä–ø—É—Å–∞ –∏ —Å–≤—è–∑–∏ –º–æ–¥–µ–ª—å‚Äì—Ä–µ–º–µ—à–æ–∫ (available_straps);
- –Ω–µ —Ç—Ä–æ–≥–∞–µ—Ç –ø—Ä–æ–º–æ–∫–æ–¥—ã –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ç–æ—Ä–∞.

–ü–µ—Ä–µ–¥ –∏–º–ø–æ—Ä—Ç–æ–º —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –±–∞–∑–∞ —É–∂–µ —Å–æ–∑–¥–∞–Ω–∞ (–º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã): `yarn prisma:migrate`.

---

## üì• –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –±—ç–∫–∞–ø–∞ bd.json –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ (–æ–¥–∏–Ω —Ä–∞–∑, –≤—Ä—É—á–Ω—É—é)

–ò–º–ø–æ—Ä—Ç **–Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è** –ø—Ä–∏ –¥–µ–ø–ª–æ–µ. –ï–≥–æ –Ω—É–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –æ–¥–∏–Ω —Ä–∞–∑ –≤—Ä—É—á–Ω—É—é (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –¥–µ–ø–ª–æ–µ), –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –∑–∞–ª–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ `bd.json` –≤ –ø—Ä–æ–¥.

**–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è:**

1. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å `bd.json` –Ω–∞ —Å–µ—Ä–≤–µ—Ä (–µ—Å–ª–∏ –µ—â—ë –Ω–µ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏):
   ```bash
   scp bd.json user@server.example.com:/path/to/project/bd.json
   ```

2. –ó–∞–ø—É—à–∏—Ç—å —Ñ–∞–π–ª –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å –∏–º–ø–æ—Ä—Ç:
   ```bash
   # –ò–º—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –ø—Ä–æ–¥–∞: slavalarionov-backend-prod
   docker cp bd.json slavalarionov-backend-prod:/app/backend/bd.json

   docker exec slavalarionov-backend-prod sh -c "cd /app/backend && DATABASE_URL='file:./prisma/prod.db' node prisma/import-backup.js bd.json"
   ```

3. –°–∫—Ä–∏–ø—Ç —Å–∫–∞—á–∞–µ—Ç –∫–∞—Ä—Ç–∏–Ω–∫–∏ –≤ `/app/backend/uploads` –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (—Ç–æ–º `backend_uploads_prod`), –ø–æ–¥—Å—Ç–∞–≤–∏—Ç –ª–æ–∫–∞–ª—å–Ω—ã–µ –ø—É—Ç–∏ –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç –ë–î. –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –Ω–µ –Ω—É–∂–µ–Ω ‚Äî –¥–∞–Ω–Ω—ã–µ —É–∂–µ –≤ volume.

–ï—Å–ª–∏ `bd.json` –ª–µ–∂–∏—Ç –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:
   ```bash
   docker cp ./bd.json slavalarionov-backend-prod:/app/backend/bd.json
   docker exec slavalarionov-backend-prod sh -c "cd /app/backend && DATABASE_URL='file:./prisma/prod.db' node prisma/import-backup.js bd.json"
   ```

–°–∫—Ä–∏–ø—Ç –∏–º–ø–æ—Ä—Ç–∞ –ø–æ–ø–∞–¥–∞–µ—Ç –≤ –æ–±—Ä–∞–∑ –ø—Ä–∏ —Å–±–æ—Ä–∫–µ (–∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –≤ `prisma/import-backup.js`), –æ—Ç–¥–µ–ª—å–Ω–æ –Ω–∏—á–µ–≥–æ —Å—Ç–∞–≤–∏—Ç—å –Ω–µ –Ω—É–∂–Ω–æ.

---

## üìä –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã SQLite

```sql
-- –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü
.tables

-- –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ç–∞–±–ª–∏—Ü—ã
.schema watch_models

-- –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–∞–Ω–Ω—ã—Ö
SELECT * FROM watch_models;

-- –ü–æ–¥—Å—á–µ—Ç –∑–∞–ø–∏—Å–µ–π
SELECT COUNT(*) FROM watch_models;

-- –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
.mode csv
.output models.csv
SELECT * FROM watch_models;
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–ù–µ –∏–∑–º–µ–Ω—è–π—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –Ω–∞–ø—Ä—è–º—É—é!** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏–ª–∏ —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏.

2. **–†–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏:** –í—Å–µ–≥–¥–∞ —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏ –ø–µ—Ä–µ–¥ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π:
   ```bash
   cp backend/prisma/dev.db backend/prisma/dev.db.backup
   ```

3. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ SSH –∫–ª—é—á–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏ –¥–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–µ—Ä—É –∑–∞—â–∏—â–µ–Ω.

4. **–†–∞–∑–º–µ—Ä –±–∞–∑—ã:** SQLite –±–∞–∑—ã –º–æ–≥—É—Ç –±—ã—Ç—å –±–æ–ª—å—à–∏–º–∏, —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –µ—Å—Ç—å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–µ—Å—Ç–∞ –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è.

---

## üÜò –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º–∞: –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–º—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
ssh user@server.example.com "docker ps | grep slavalarionov"
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –Ω–∞–π–¥–µ–Ω–∞
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—É—Ç—å –∫ –±–∞–∑–µ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
ssh user@server.example.com "docker exec slavalarionov-backend-dev ls -la /app/backend/prisma/"
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ù–µ—Ç –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –Ω–∞ —Ñ–∞–π–ª
ssh user@server.example.com "docker exec slavalarionov-backend-dev ls -la /app/backend/prisma/dev.db"
```
